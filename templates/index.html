{% extends "base.html" %}
{% block title %}Главная{% endblock %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-5">
    <!-- Форма для добавления заметок -->
    <form method="post" action="{{ url_for('index') }}" class="mb-3">
        <div class="mb-3">
            <textarea class="form-control" name="note" placeholder="Введите заметку" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Добавить заметку</button>
    </form>

    <!-- Вывод сообщений flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <!-- Список заметок -->
    <div class="list-group mt-3">
        {% for note in notes %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>{{ note.timestamp.strftime('%d-%m-%Y %H:%M') }}:</strong>
                {{ note.content }}
            </div>
            <a href="{{ url_for('delete_note', note_id=note.id) }}" class="btn btn-danger btn-sm">Удалить</a>
        </div>
        {% else %}
        <div class="alert alert-info">Нет заметок</div>
        {% endfor %}
    </div>

    <!-- Календарь -->
    <div id="calendar" class="mt-4"></div>
</div>

<!-- Подключение FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<!-- Подключение русской локализации -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales/ru.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            slotMinTime: "08:30:00",
            slotMaxTime: "20:30:00",
            firstDay: 1, // Первый день недели - понедельник
            locale: 'ru', // Русская локализация
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'timeGridDay,timeGridWeek,dayGridMonth'
            },
            buttonText: {
                today: 'Сегодня',
                month: 'Месяц',
                week: 'Неделя',
                day: 'День'
            },
            nowIndicator: true,
            events: '/api/appointments',

            eventClick: function (info) {
                window.location.href = `/appointment/${info.event.id}`;
            },

            dateClick: function (info) {
                let selectedDate = info.dateStr.split("T")[0];
                let selectedTime = info.dateStr.split("T")[1] ? info.dateStr.split("T")[1].substring(0, 5) : "08:00";
                window.location.href = `/appointment/new?date=${selectedDate}&time=${selectedTime}`;
            }
        });

        calendar.render();
    });
</script>

{% endblock %}