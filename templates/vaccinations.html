{% extends "base.html" %}
{% block title %}Отчёты{% endblock %}

{% block content %}
<div class="container mt-3">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center mb-4">
                <i class="bi bi-file-earmark-text"></i> Отчёты
            </h1>
        </div>
    </div>

    <!-- Карточки с типами отчётов -->
    <div class="row g-4">
        <!-- Отчёт по вакцинациям от бешенства -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="bi bi-shield-check text-primary" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Отчёт по вакцинациям от бешенства</h5>
                    <p class="card-text text-muted">
                        Генерация отчёта по вакцинациям от бешенства за выбранный период
                    </p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#rabiesReportModal">
                        <i class="bi bi-file-earmark-pdf"></i> Создать отчёт
                    </button>
                </div>
            </div>
        </div>

        <!-- Отчёт по всем вакцинациям -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="bi bi-eyedropper text-success" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Отчёт по всем вакцинациям</h5>
                    <p class="card-text text-muted">
                        Экспорт контактных данных владельцев для напоминаний о вакцинациях
                    </p>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#allVaccinationsModal">
                        <i class="bi bi-download"></i> Экспорт данных
                    </button>
                </div>
            </div>
        </div>

        <!-- Статистический отчёт -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="bi bi-graph-up text-info" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Статистический отчёт</h5>
                    <p class="card-text text-muted">
                        Переход к детальной статистике клиники с графиками и аналитикой
                    </p>
                    <a href="{{ url_for('statistics') }}" class="btn btn-info">
                        <i class="bi bi-bar-chart"></i> Открыть статистику
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Дополнительные инструменты -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-3">
                <i class="bi bi-tools"></i> Дополнительные инструменты
            </h3>
        </div>
    </div>

    <div class="row g-4">
        <!-- Просмотр всех вакцинаций -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-list-ul"></i> Просмотр всех вакцинаций
                    </h5>
                    <p class="card-text">
                        Просмотр и поиск по всем записям вакцинаций в базе данных
                    </p>
                    <a href="{{ url_for('vaccinations_list') }}" class="btn btn-outline-primary">
                        <i class="bi bi-search"></i> Просмотреть
                    </a>
                </div>
            </div>
        </div>

        <!-- Управление назначениями -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-clipboard2-pulse"></i> Управление назначениями
                    </h5>
                    <p class="card-text">
                        Добавление, редактирование и управление медицинскими назначениями
                    </p>
                    <a href="{{ url_for('list_treatments') }}" class="btn btn-outline-primary">
                        <i class="bi bi-gear"></i> Управлять
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для отчёта по бешенству -->
<div class="modal fade" id="rabiesReportModal" tabindex="-1" aria-labelledby="rabiesReportModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rabiesReportModalLabel">
                    <i class="bi bi-shield-check"></i> Отчёт по вакцинациям от бешенства
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{{ url_for('generate_report') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="start_date" class="form-label">Дата начала</label>
                        <input type="date" class="form-control" id="start_date" name="start_date" required>
                    </div>
                    <div class="mb-3">
                        <label for="end_date" class="form-label">Дата окончания</label>
                        <input type="date" class="form-control" id="end_date" name="end_date" required>
                    </div>
                    <input type="hidden" name="report_type" value="rabies">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Информация:</strong> Отчёт будет сгенерирован в формате PDF и автоматически загружен.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-file-earmark-pdf"></i> Создать отчёт
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Модальное окно для экспорта всех вакцинаций -->
<div class="modal fade" id="allVaccinationsModal" tabindex="-1" aria-labelledby="allVaccinationsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="allVaccinationsModalLabel">
                    <i class="bi bi-eyedropper"></i> Экспорт данных по вакцинациям
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{{ url_for('generate_report') }}">
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Внимание:</strong> Будет создан ZIP-архив с контактными данными владельцев
                        за период 11 месяцев назад от текущей даты.
                    </div>
                    <input type="hidden" name="report_type" value="all">
                    <div class="mb-3">
                        <label class="form-label">Период экспорта</label>
                        <div class="form-control-plaintext">
                            <i class="bi bi-calendar"></i>
                            Автоматически: 11 месяцев назад от текущей даты
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Содержимое архива:</strong>
                        <ul class="mb-0 mt-2">
                            <li>correct_phones.txt - корректные номера телефонов</li>
                            <li>incorrect_phones.txt - некорректные номера телефонов</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-download"></i> Экспортировать
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Устанавливаем даты по умолчанию для отчёта по бешенству
        const today = new Date();
        const oneMonthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());

        document.getElementById('start_date').value = oneMonthAgo.toISOString().split('T')[0];
        document.getElementById('end_date').value = today.toISOString().split('T')[0];
    });
</script>

{% endblock %}