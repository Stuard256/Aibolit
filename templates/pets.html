{% extends "base.html" %}
{% block title %}Список животных{% endblock %}
{% block content %}
<h2>Список животных</h2>

<form method="get" class="mb-3">
  <div class="row g-3">
    <div class="col-md-5">
      <input type="text" name="search_owner" class="form-control" placeholder="Часть ФИО владельца"
        value="{{ search_owner }}">
    </div>
    <div class="col-md-5">
      <input type="text" name="search_pet" class="form-control" placeholder="Часть клички животного"
        value="{{ search_pet }}">
    </div>
    <div class="col-md-2">
      <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a class="btn btn-secondary" href="{{ url_for('add_pet') }}">Добавить животное</a>
        <button type="submit" class="btn btn-primary">Найти</button>
        <a href="{{ url_for('pets_list') }}" class="btn btn-outline-secondary">Сбросить</a>
      </div>
    </div>
  </div>
</form>

{% if pets %}
<div class="table-responsive">
  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th>Владелец</th>
        <th>Кличка</th>
        <th>Номер карточки</th>
        <th>Вид</th>
        <th>Пол</th>
        <th>Порода</th>
        <th>Окрас</th>
        <th>Дата рождения</th>
      </tr>
    </thead>
    <tbody>
      {% for pet in pets %}
      <tr>
        <td><a href="{{ url_for('owner_card', owner_id=pet.owner.id) }}">{{ pet.owner.name }}</a></td>
        <td><a href="{{ url_for('pet_card', pet_id=pet.id) }}">{{ pet.name }}</a></td>
        <td>{{ pet.card_number }}</td>
        <td>{{ pet.species }}</td>
        <td>{{ pet.gender }}</td>
        <td>{{ pet.breed }}</td>
        <td>{{ pet.coloration }}</td>
        <td>{{ pet.birth_date.strftime('%d-%m-%Y') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Обновленная пагинация с передачей параметров -->
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if pagination.has_prev %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('pets_list', page=pagination.prev_num, 
               search_owner=search_owner, search_pet=search_pet) }}">
        Назад
      </a>
    </li>
    {% endif %}

    {% for page_num in pagination.iter_pages() %}
    {% if page_num %}
    <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('pets_list', page=page_num, 
                 search_owner=search_owner, search_pet=search_pet) }}">
        {{ page_num }}
      </a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
    {% endif %}
    {% endfor %}

    {% if pagination.has_next %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('pets_list', page=pagination.next_num, 
               search_owner=search_owner, search_pet=search_pet) }}">
        Вперед
      </a>
    </li>
    {% endif %}
  </ul>
</nav>

<div class="text-muted text-center">
  Страница {{ pagination.page }} из {{ pagination.pages }}
</div>
{% else %}
<div class="alert alert-info">Животные не найдены</div>
{% endif %}
{% endblock %}