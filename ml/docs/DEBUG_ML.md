# Отладка ML диагностики

## Проблема: JSON.parse error

Если вы получаете ошибку `JSON.parse: unexpected character at line 1 column 1`, это означает, что сервер возвращает HTML вместо JSON.

## Пошаговая отладка

### 1. Проверьте модель
```bash
python check_model.py
```

### 2. Проверьте API напрямую
```bash
python test_api.py
```

### 3. Проверьте логи сервера
Запустите сервер и посмотрите на вывод в консоли:
```bash
python app.py
```

### 4. Проверьте в браузере
1. Откройте Developer Tools (F12)
2. Перейдите на вкладку Network
3. Попробуйте диагностику
4. Посмотрите на запрос к `/diagnose`

## Возможные причины ошибки

### 1. Модель не загружена
**Симптомы**: В логах сервера "ML модель не загружена"
**Решение**: 
```bash
python train_model.py
```

### 2. Ошибка в коде
**Симптомы**: В логах сервера ошибка Python
**Решение**: Проверьте логи и исправьте ошибку

### 3. Неправильный Content-Type
**Симптомы**: Сервер возвращает HTML страницу с ошибкой
**Решение**: Убедитесь, что запрос отправляется как JSON

### 4. Проблемы с импортами
**Симптомы**: ModuleNotFoundError в логах
**Решение**: 
```bash
pip install scikit-learn pandas numpy joblib
```

## Быстрое решение

### Вариант 1: Переобучите модель
```bash
# Удалите старую модель
rm animal_disease_model.pkl

# Переобучите
python train_model.py

# Перезапустите сервер
python app.py
```

### Вариант 2: Проверьте зависимости
```bash
pip install -r requirements_ml.txt
```

### Вариант 3: Проверьте файлы
Убедитесь, что существуют:
- `animal_disease_model.pkl`
- `ml_model.py`
- `app.py`

## Тестирование

### 1. Тест модели
```bash
python test_ml.py
```

### 2. Тест API
```bash
python test_api.py
```

### 3. Тест в браузере
1. Откройте `http://localhost:5000/diagnosis`
2. Выберите животное и симптомы
3. Нажмите "Диагностировать"
4. Проверьте консоль браузера (F12)

## Ожидаемый результат

При успешной работе вы должны увидеть:
1. В логах сервера: "DEBUG: Предсказания получены: [...]"
2. В браузере: Список заболеваний с вероятностями
3. В консоли браузера: "Parsed data: {success: true, predictions: [...]}"

## Если ничего не помогает

1. **Перезапустите сервер**:
   ```bash
   # Остановите сервер (Ctrl+C)
   python app.py
   ```

2. **Проверьте порт**:
   Убедитесь, что порт 5000 свободен

3. **Проверьте права доступа**:
   Убедитесь, что у вас есть права на чтение файлов

4. **Очистите кэш браузера**:
   Нажмите Ctrl+F5 для обновления страницы
